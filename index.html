<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fantasya - Le Jeu</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; overflow: hidden; }
        
        /* Barre d'√©tat am√©lior√©e */
        #status-bar { background: #16213e; padding: 15px; display: flex; justify-content: space-around; align-items: center; border-bottom: 3px solid #e94560; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .stat { font-size: 18px; font-weight: bold; background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; }
        .stat span { color: #e94560; font-size: 22px; }

        /* Zones de jeu */
        #game-board { height: 55vh; display: flex; align-items: center; justify-content: center; gap: 20px; padding: 20px; flex-wrap: wrap; }
        #player-hand { height: 35vh; display: flex; justify-content: center; align-items: center; gap: 10px; padding: 10px; background: rgba(0,0,0,0.4); border-top: 2px solid #444; }

        /* Design des Cartes */
        .card { width: 130px; height: 185px; background: white; color: #333; border-radius: 10px; padding: 8px; font-size: 11px; cursor: pointer; transition: all 0.3s; border: 3px solid #333; box-shadow: 0 5px 15px rgba(0,0,0,0.3); position: relative; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-15px) scale(1.05); border-color: #e94560; z-index: 10; }
        
        /* Couleurs par Type */
        .card.personnage { border-color: #2196f3; background: #f0f7ff; }
        .card.activit√© { border-color: #ff9800; background: #fffde7; }
        .card.chanson { border-color: #9c27b0; background: #fdf0ff; }
        .card.objet { border-color: #4caf50; background: #f1fff2; }
        .card.r√¥le { border-color: #795548; background: #efebe9; }

        .card-header { font-weight: bold; border-bottom: 1px solid #ccc; margin-bottom: 5px; font-size: 12px; color: #000; }
        .card-rules { flex-grow: 1; font-style: italic; font-size: 10px; margin-top: 5px; line-height: 1.2; }
        .card-footer { display: flex; justify-content: space-between; font-weight: bold; margin-top: 5px; }

        /* Boutons */
        button { background: #e94560; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #ff5e78; transform: scale(1.05); }
        button:disabled { background: #555; cursor: not-allowed; }

        .occupe { opacity: 0.6; filter: grayscale(80%); border: 3px dashed #ff9800 !important; }
        .card.occupe::after {
        content: "üí§ SOMMEIL";
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 5px;
        font-weight: bold;
        border-radius: 5px;
        font-size: 14px;
}
        /* √âcran de Victoire */
        #victory-screen {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
}
        #victory-screen h1 { font-size: 80px; color: #e94560; text-shadow: 0 0 20px #ff5e78; margin: 0; }
        #victory-screen p { font-size: 24px; color: white; }
    </style>
</head>
<body>
<div id="victory-screen">
    <h1>VICTOIRE !</h1>
    <p>Vous avez atteint 50 points de Fantaisie.</p>
    <button onclick="location.reload()">Rejouer</button>
</div>
    
<div id="status-bar">
    <div class="stat">Fantaisie: <span id="fantaisie">0</span>/50</div>
    <div class="stat">Imagination: <span id="imagination">5</span></div>
    <div class="stat">Temps: <span id="temps">3</span></div>
    <button id="btn-mulligan" onclick="mulligan()">Mulligan (1x)</button>
    <button onclick="finirTour()">Finir le Tour (Sommeil)</button>
</div>

<div id="game-board">
    </div>

<div id="player-hand">
    </div>

<script>
    let bddCartes = [];
    let deck = [];
    let mainJoueur = [];
    let activitesEnAttente = [];
    let imagination = 5;
    let temps = 3;
    let scoreFantaisie = 0;
    let mulliganFait = false;

    async function initialiserJeu() {
        try {
            // Chargement s√©curis√© pour GitHub Pages
            const response = await fetch('./fantasya_cards.json');
            bddCartes = await response.json();
            deck = [...bddCartes].sort(() => 0.5 - Math.random());
            pigerMainInitiale();
        } catch (e) {
            alert("Erreur : Assurez-vous que fantasya_cards.json est bien sur votre GitHub !");
        }
    }

    function pigerMainInitiale() {
        mainJoueur = deck.splice(0, 7);
        afficherMain();
    }

    function mulligan() {
        if(!mulliganFait) {
            // On remet les cartes dans le deck et on rem√©lange
            deck.push(...mainJoueur);
            deck.sort(() => 0.5 - Math.random());
            mainJoueur = deck.splice(0, 7);
            mulliganFait = true;
            document.getElementById('btn-mulligan').disabled = true;
            document.getElementById('btn-mulligan').innerText = "Mulligan utilis√©";
            afficherMain();
            alert("Mulligan effectu√© !");
        }
    }

    function afficherMain() {
        const handDiv = document.getElementById('player-hand');
        handDiv.innerHTML = "";
        mainJoueur.forEach((carte, index) => {
            const cardEl = document.createElement('div');
            cardEl.className = `card ${carte.type.toLowerCase()}`;
            cardEl.innerHTML = `
                <div class="card-header">${carte.nom}</div>
                <div style="font-size:9px; color:#666">${carte.univers}</div>
                <div class="card-rules">${carte.regles}</div>
                <div class="card-footer">
                    <span>üíé ${carte.cout}</span>
                    <span>${carte.stats ? '‚öîÔ∏è'+carte.stats.force : ''}</span>
                </div>
            `;
            cardEl.onclick = () => jouerCarte(index);
            handDiv.appendChild(cardEl);
        });
    }

    function jouerCarte(index) {
        const carte = mainJoueur[index];
        
        if (imagination >= carte.cout) {
            if (carte.type === "Activit√©") {
                if (temps >= 1) {
                    lancerActivite(carte, index);
                } else { alert("Pas assez de Temps !"); }
            } else {
                imagination -= carte.cout;
                if (carte.type === "Personnage") poserSurTerrain(carte);
                mainJoueur.splice(index, 1);
            }
            actualiserStats();
            afficherMain();
        } else {
            alert("Pas assez d'Imagination !");
        }
    }

    function poserSurTerrain(carte) {
        const board = document.getElementById('game-board');
        const cardEl = document.createElement('div');
        cardEl.className = "card personnage";
        cardEl.innerHTML = `
            <div class="card-header">${carte.nom}</div>
            <div class="card-rules" style="font-size:9px">${carte.regles}</div>
            <div class="card-footer">
                <span>üõ°Ô∏è ${carte.stats.endurance}</span>
                <span>‚öîÔ∏è ${carte.stats.force}</span>
            </div>
        `;
        board.appendChild(cardEl);
    }

    function lancerActivite(carte, index) {
        const persosLibres = document.querySelectorAll('#game-board .card.personnage:not(.occupe)');
        if (persosLibres.length > 0) {
            imagination -= carte.cout;
            temps -= 1;
            const perso = persosLibres[0];
            perso.classList.add('occupe');
            activitesEnAttente.push({ carte: carte, element: perso });
            mainJoueur.splice(index, 1);
        } else {
            alert("Il faut un personnage libre sur le terrain !");
        }
    }

    function finirTour() {
    let totalGainCeTour = 0;

    // Phase de R√©cup√©ration (Demain) : On r√©sout les activit√©s
    activitesEnAttente.forEach(act => {
        let gain = 0;
        const id = act.carte.id;

        // Dictionnaire des gains selon ton fichier JSON
        if (id === "0003") gain = 10; // Bal dans le Bayou
        else if (id === "0004") gain = 4;  // Balade √† Dos d‚ÄôAutruche
        else if (id === "0013") gain = 5;  // Chasse Nocturne
        else if (id === "0014") gain = 6;  // Chasser dans la savane
        else if (id === "0022") gain = 4;  // Course en for√™t
        else if (id === "0023") gain = 10; // Croquet Royal
        else if (id === "0024") gain = 5;  // Cuisine Du Gombo
        else if (id === "0028") gain = 5;  // Entra√Ænement au Camp
        else if (id === "0030") gain = 10; // Escalade du poteau
        else if (id === "0032") gain = 8;  // √âvasion de la Caverne aux Merveilles
        else if (id === "0035") gain = 7;  // Exploration d‚Äô√©paves
        else if (id === "0037") gain = 6;  // Festival Des Lumi√®res
        else if (id === "0064") gain = 6;  // Navigation Astrale
        else if (id === "0067") gain = 10; // Pacte avec la Sorci√®re
        else if (id === "0071") gain = 4;  // Peinture murale
        else if (id === "0081") gain = 4;  // Saut de la cascade
        else if (id === "0085") gain = 3;  // Sieste dans la Jungle
        else if (id === "0094") gain = 4;  // Tea Party
        else if (id === "0096") gain = 6;  // Travers√© du R√©cif
        else if (id === "0099") gain = 2;  // Vol au March√© (base)
        else gain = 2; // Gain par d√©faut pour les autres activit√©s

        scoreFantaisie += gain;
        totalGainCeTour += gain;

        // On lib√®re le personnage
        act.element.classList.remove('occupe');
    });

    if(totalGainCeTour > 0) {
        alert(`Matin√©e : Vos activit√©s sont termin√©es ! Gain de +${totalGainCeTour} Fantaisie.`);
    }

    activitesEnAttente = [];

    // Phase de Pioche automatique
    if (deck.length > 0) {
        mainJoueur.push(deck.shift());
    } else {
        alert("Plus de cartes dans la pioche !");
    }

    // Reset des ressources (Phase de R√©veil)
    imagination = 5;
    temps = 3;

    actualiserStats();
    afficherMain();
}
    function actualiserStats() {
    document.getElementById('imagination').innerText = imagination;
    document.getElementById('temps').innerText = temps;
    document.getElementById('fantaisie').innerText = scoreFantaisie;

    // Condition de Victoire
    if (scoreFantaisie >= 50) {
        document.getElementById('victory-screen').style.display = 'flex';
    }
}

function finirTour() {
    // 1. Phase de Sommeil (V√©rification des activit√©s)
    if (activitesEnAttente.length > 0) {
        activitesEnAttente.forEach(act => {
            // On r√©cup√®re les points de la carte (si pas de score, on donne 5 par d√©faut)
            let gain = 5; 
            // Exemple : si c'est Ariel (ID 0001), elle pourrait donner plus
            scoreFantaisie += gain;
            
            // On lib√®re le personnage
            act.element.classList.remove('occupe');
            let infoAttente = act.element.querySelector('.status-txt');
            if(infoAttente) infoAttente.remove();
        });
        alert(`Tour termin√© ! Vos activit√©s vous ont rapport√© des points.`);
        activitesEnAttente = [];
    }

    // 2. Phase de Pioche automatique
    if (deck.length > 0) {
        mainJoueur.push(deck.shift());
    }

    // 3. Reset des ressources (Phase de R√©veil)
    imagination = 5;
    temps = 3;

    actualiserStats();
    afficherMain();
}
    initialiserJeu();
</script>
</body>
</html>
</body>

</html>




